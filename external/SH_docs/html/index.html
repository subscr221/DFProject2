<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BB API: BB60 API Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="sh-logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">BB API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">BB60 API Reference </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md6">Examples</a></li>
<li class="level1"><a href="#autotoc_md7">Measurements</a></li>
<li class="level1"><a href="#autotoc_md8">Build/Version Notes</a><ul><li class="level2"><a href="#autotoc_md9">Builds</a></li>
<li class="level2"><a href="#autotoc_md10">Versions</a><ul><li class="level3"><a href="#autotoc_md11">What’s New in Version 5.0</a></li>
<li class="level3"><a href="#autotoc_md12">What’s New in Version 4.0</a></li>
<li class="level3"><a href="#autotoc_md13">What’s New in Version 3.0</a></li>
<li class="level3"><a href="#autotoc_md14">What’s New in version 2.0</a></li>
<li class="level3"><a href="#autotoc_md15">Updating from Version 1.2 or Later</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md16">Requirements</a><ul><li class="level2"><a href="#autotoc_md17">Windows Development Requirements</a></li>
<li class="level2"><a href="#autotoc_md18">Linux Development Requirements</a></li>
<li class="level2"><a href="#autotoc_md19">PC Requirements</a></li>
</ul>
</li>
<li class="level1"><a href="#UARTAntennaSwitching">UART Antenna Switching</a></li>
<li class="level1"><a href="#autotoc_md20">Thread Safety</a></li>
<li class="level1"><a href="#multipleDevicesAndProcesses">Multiple Devices and Multiple Processes</a></li>
<li class="level1"><a href="#powerState">Power State</a></li>
<li class="level1"><a href="#autotoc_md21">Linux Notes</a><ul><li class="level2"><a href="#autotoc_md22">USB Throughput</a></li>
<li class="level2"><a href="#multipleDevicesLinux">Multiple USB Devices</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md23">Other Programming Languages</a></li>
<li class="level1"><a href="#autotoc_md24">Device Connection Errors</a><ul><li class="level2"><a href="#autotoc_md25">Firmware Version 7 (BB60C)</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md26">Manual Gain/Attenuation</a></li>
<li class="level1"><a href="#IQDataTypes">I/Q Data Types</a></li>
<li class="level1"><a href="#IQFilteringAndBandwidthLimitations">I/Q Filtering and Bandwidth Limitations</a></li>
<li class="level1"><a href="#gpsAndTimestamps">Using a GPS Receiver to Time-Stamp Data</a><ul><li class="level2"><a href="#autotoc_md27">Code Example</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md28">Calculating FFT Size</a></li>
<li class="level1"><a href="#autotoc_md29">Contact Information</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="mainpage"></a></p>
<p >This manual is a reference for the Signal Hound BB60 application programming interface (API). This API supports the <a href="https://signalhound.com/products/bb60d-6-ghz-real-time-spectrum-analyzer/">BB60D</a>, <a href="https://signalhound.com/products/bb60c/">BB60C</a>, and BB60A Signal Hound devices. The API provides a set of C functions for making measurements with the BB60 devices. The API is C ABI compatible making is possible to be interfaced from most programming languages. See the code examples in the SDK for examples of calling the API from C++ and other programming languages and environments.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Examples</h1>
<p >All code examples are located in the <em>examples/</em> folder in the SDK which can be downloaded at <a href="www.signalhound.com/software-development-kit">www.signalhound.com/software-development-kit</a>.</p>
<h1><a class="anchor" id="autotoc_md7"></a>
Measurements</h1>
<p >This section covers the main measurements available through the API.</p>
<ul>
<li><a class="el" href="measurement_types.html#sweepMode">Swept Spectrum Analysis</a></li>
<li><a class="el" href="measurement_types.html#realTimeAnalysis">Real-Time Spectrum Analysis</a></li>
<li><a class="el" href="measurement_types.html#IQStreaming">I/Q Streaming</a></li>
<li><a class="el" href="measurement_types.html#audioDemod">Audio Demodulation</a></li>
<li><a class="el" href="measurement_types.html#snaMode">Scalar Network Analysis</a></li>
</ul>
<p >Also see <a class="el" href="theory_of_operation.html">Theory of Operation</a> for more information.</p>
<h1><a class="anchor" id="autotoc_md8"></a>
Build/Version Notes</h1>
<h2><a class="anchor" id="autotoc_md9"></a>
Builds</h2>
<p >Both Windows and Linux builds are available in the SDK.</p>
<p >Windows builds are available for both x86 and x64. The Windows builds are compiled with Visual Studio 2019 and 2012 and any application using this library will require distributing the <a href="https://learn.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist?view=msvc-170">VS2019 redistributable libraries</a> or <a href="https://www.microsoft.com/en-us/download/details.aspx?id=30679">VS2012 redistributable libraries</a>.</p>
<p >Linux versions are available for 64-bit Ubuntu 22.04/20.04/18.04 and CentOS7.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Versions</h2>
<p >Versions are of the form <em>major.minor.revision</em>.</p>
<p >A <em>major</em> change signifies a significant change in functionality relating to one or more measurements, or the addition of significant functionality. Function prototypes have likely changed.</p>
<p >A <em>minor</em> change signifies additions that may improve existing functionality or fix major bugs but make no changes that might affect existing user’s measurements. Function prototypes can change but do not change existing parameters meanings.</p>
<p >A <em>revision</em> change signifies minor changes or bug fixes. Function prototypes will not change. Users should be able to update by simply replacing the .DLL/.so.</p>
<p >See the change log in the SDK for detailed API version history.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
What’s New in Version 5.0</h3>
<ul>
<li>Added support for the BB60D.</li>
<li>For existing programs only utilizing BB60C/A devices, no software changes are required when using the new DLL.</li>
<li>Some functions require different parameters when using the BB60D, such as <a class="el" href="bb__api_8h.html#abaf1a8ac8259ff021c0d34d0f11f5d0d">bbConfigureIO</a>.</li>
<li>A new device type is returned from the <a class="el" href="bb__api_8h.html#aeccd694c454b674f244b3390d433edb0">bbGetDeviceType</a> function to detect the BB60D when connected.</li>
<li>New functions have been added specifically for the BB60D. These functions configure and enable the UART output for various types of antenna switching. See <a class="el" href="index.html#UARTAntennaSwitching">UART Antenna Switching</a>.</li>
<li>Some functions have been deprecated but will continue to be present in the API for existing applications. Alternatives have been provided for these functions.<ul>
<li><a class="el" href="bb__api_8h.html#aef095decdcc0c3d5d8cb8c0e962dafae">bbConfigureRefLevel</a> replaces bbConfigureLevel</li>
<li><a class="el" href="bb__api_8h.html#a2a89a380c30677d6279f8c283c897ead">bbConfigureGainAtten</a> replaces bbConfigureGain</li>
<li><a class="el" href="bb__api_8h.html#ac432defe33151bd061c8accd3a008d4e">bbQueryIQParameters</a> replaces bbQueryStreamInfo</li>
</ul>
</li>
<li>Several macros have been deprecated but remain in the API header file for existing applications. The updated and more descriptive macro names should be used.</li>
<li>Added function <a class="el" href="bb__api_8h.html#a63052a9095f9bffbf94ed578824fbc50">bbGetSerialNumberList2</a>, which also returns the device type. Enables the ability to target a specific device type when opening a device.</li>
</ul>
<h3><a class="anchor" id="autotoc_md12"></a>
What’s New in Version 4.0</h3>
<ul>
<li>Added support for the BB60C-2, a minor hardware revision to the BB60C. The non-deprecated functions have not changed, so integrating the new BB60C-2 devices should require no software changes other than updating the API DLL in the project.</li>
<li>Several deprecated functions have been removed. There are alternatives for each deprecated function.<ul>
<li>bbFetchRaw: use <a class="el" href="bb__api_8h.html#aad55bfbe52c9620a1551807127d19065">bbGetIQ</a> instead.</li>
<li>bbConfigureWindow: use <a class="el" href="bb__api_8h.html#a80f48f1526f2b51ada3f6b3fbaa2393e">bbConfigureSweepCoupling</a> instead.</li>
<li>bbQueryTimestamp: use <a class="el" href="bb__api_8h.html#aad55bfbe52c9620a1551807127d19065">bbGetIQ</a> instead.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md13"></a>
What’s New in Version 3.0</h3>
<p >Version 3.0 coincides with the release of the Spike, Signal Hounds latest spectrum analyzer software. With this release comes the ability to open specific BB60C devices. BB60A devices lack the firmware to perform this task. See <a class="el" href="bb__api_8h.html#a572ab303e84a8cc4f882ee1304e81ce7">bbGetSerialNumberList</a> and <a class="el" href="bb__api_8h.html#a460f1548c42604ba74613787b28e77e6">bbOpenDeviceBySerialNumber</a> for more information.</p>
<h3><a class="anchor" id="autotoc_md14"></a>
What’s New in version 2.0</h3>
<p >Version 2.0 and greater introduces support for the BB60C as well as numerous performance improvements and flexible I/Q data streaming. The API can target both the BB60A and BB60C with virtually no changes to how one interfaces the API.</p>
<h3><a class="anchor" id="autotoc_md15"></a>
Updating from Version 1.2 or Later</h3>
<p >This section contains notes of interest for users who are currently using version 1.2 of the API and who are updating their code base to use version 2.0.</p>
<ul>
<li>Function names and the API file names may have changed from an earlier version. This is due to making the API device agnostic. Functionally the API remains the same, so simply updating to the newer naming scheme will be all that is necessary to interface a newer API.</li>
<li>Intermediate frequency (IF) streaming has been replaced with I/Q streaming but IF streaming can still be performed. See <a class="el" href="bb__api_8h.html#a94837e7f5ac6882499f46db29bbc0427">bbInitiate</a> for more information on how to set up IF streaming.</li>
<li>bbQueryDiagnostics has been deprecated and replaced with <a class="el" href="bb__api_8h.html#ab81b4d3a8daefedbdcda2340d176c8e4">bbGetDeviceDiagnostics</a>. This change removes unnecessary access to hardware diagnostic information specific to the BB60A.</li>
</ul>
<h1><a class="anchor" id="autotoc_md16"></a>
Requirements</h1>
<h2><a class="anchor" id="autotoc_md17"></a>
Windows Development Requirements</h2>
<ul>
<li>Windows 11/10</li>
<li>Windows C/C++ development tools and environment.<ul>
<li>API was compiled using VS2019 and VS2012.<ul>
<li>VS2019/VS2012 C++ redistributables are required.</li>
</ul>
</li>
</ul>
</li>
<li><a class="el" href="bb__api_8h.html" title="API functions for the BB60 spectrum analyzers.">bb_api.h</a>, API header file.</li>
<li>bb_api.lib/bb_api.dll, These are the main API library files.</li>
<li>ftd2xx.dll, Provided in SDK. Must be in the same directory as the bb_api.dll. Used for scalar network analysis sweeps with the Signal Hound tracking generator.</li>
</ul>
<h2><a class="anchor" id="autotoc_md18"></a>
Linux Development Requirements</h2>
<ul>
<li>64-bit Linux operating system. (Tested and developed on Ubuntu 18.04 and CentOS7)</li>
<li>C++ compiler (Built using g++)</li>
<li>The API header file. (Included in SDK)</li>
<li>The API shared library (Included in SDK)</li>
<li>FTDI USB shared library (Included in SDK and available for download from manufacturer)</li>
<li>libusb-1.0 shared library (Available from most package managers)</li>
<li>Administrator(root) access to either run applications which use the API or install rules to allow non-root access to the device.</li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
PC Requirements</h2>
<ul>
<li>USB 3.0 connectivity provided through 4th generation or later Intel CPUs.</li>
<li>(Recommended) Quad core Intel i5/i7/i9 processors, 4th generation or later.</li>
<li>(Minimum) Dual-core Intel i5/i7 processors, 4th generation or later.</li>
</ul>
<h1><a class="anchor" id="UARTAntennaSwitching"></a>
UART Antenna Switching</h1>
<p >The BB60D has a UART output on port 2. The UART port has 3 output modes:</p>
<ol type="1">
<li>Immediate, send a byte on demand.</li>
<li>Antenna switching during sweeps. During a sweep a UART byte will be transmitted at specific positions in the sweep, allowing multi-antenna coverage during a single sweep.</li>
<li>Pseudo-doppler switching during I/Q streaming. While I/Q streaming the UART can be configured to output bytes at specific intervals for pseudo-doppler direction finding applications.</li>
</ol>
<p >In all 3 output modes the UART transmits 1 byte at a time, including start and stop bit for a total of 10 bits. The output baud rate can be specified from a list of available rates using the <a class="el" href="bb__api_8h.html#ae9ccdfa7565589358f2d073316543d39">bbSetUARTRate</a> function.</p>
<p >There is no UART input capability.</p>
<p >See <a class="el" href="bb__api_8h.html#abaf1a8ac8259ff021c0d34d0f11f5d0d">bbConfigureIO</a>, the UART functions, and the C++ programming examples for more information.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Thread Safety</h1>
<p >The BB60 API is not thread safe. A multi-threaded application is free to call the API from any number of threads if the function calls are synchronized (i.e. using a mutex). Not synchronizing your function calls will lead to undefined behavior.</p>
<h1><a class="anchor" id="multipleDevicesAndProcesses"></a>
Multiple Devices and Multiple Processes</h1>
<p >The API can manage multiple devices within one process. In each process the API manages a list of open devices to prevent a process from opening a device more than once. You may open multiple devices by specifying the serial number or allowing the API to discover them automatically.</p>
<p >If you wish to use the API in multiple processes it is the user’s responsibility to manage a list of devices to prevent the possibility of opening a device twice from two different processes. Two processes communicating to the same device will result in undefined behavior. One possible way to manage inter-process information like this is to use a named mutex on a Windows system.</p>
<p >If you wish to interface multiple devices on Linux, please see <a class="el" href="index.html#multipleDevicesLinux">Multiple USB Devices</a>.</p>
<h1><a class="anchor" id="powerState"></a>
Power State</h1>
<p >The BB60D can be set into a low power state using the <a class="el" href="bb__api_8h.html#afaa27dd829ff27392cd0521183c99d68">bbSetPowerState</a> function provided by the API. Power will reduce to ~1.25W from 6W when active. The device should not be actively performing any measurements when setting the device to the standby power state and should not perform any measurements while in the standby state. Before setting the device to standby, the device should be in the idle mode (by calling <a class="el" href="bb__api_8h.html#a6dc895bf3e792c37ee5dbddf37166bb5">bbAbort</a>) or configured for sweeping but not actively performing a sweep.</p>
<p >Here are some other power state transitions that occur:</p><ul>
<li>When the device is first connected to the PC, it starts in the low power power state.</li>
<li>When the device is opened via the API, it automatically goes to the on state.</li>
<li>When the device is closed via the API, it is sent to the standby power state.</li>
<li>If the program crashes and the device is not able to be properly closed via the API, it can be left in the on state.</li>
</ul>
<p >See the C++ programming examples for an example of configuring the power state.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Linux Notes</h1>
<h2><a class="anchor" id="autotoc_md22"></a>
USB Throughput</h2>
<p >By default, Linux applications cannot increase the priority of individual threads unless ran with elevated privilege (root). On Windows this issue does not exist, and the API will elevate the USB data acquisition threads to a higher priority to ensure USB data loss does not occur. On Linux, the user will need to run their application as root to ensure USB data acquisition is performed at a higher priority.</p>
<p >If this is not done, there is a higher risk of USB data loss for streaming modes such as I/Q, real-time, and fast sweep measurements on Linux.</p>
<p >In our testing, if little additional processing is occurring outside the API, 1 or 2 devices typically will not experience data loss due to this issue. Once the user application increases the processing load or starts performing I/O such as storing data to disk, the occurrence of USB data loss increases and the need to run the application as root increases.</p>
<h2><a class="anchor" id="multipleDevicesLinux"></a>
Multiple USB Devices</h2>
<p >There are system limitations when attempting to use multiple Signal Hound USB 3.0 devices* simultaneously on Linux operating systems. The default amount of memory allocated for USB transfers on Linux is 16MB. A single Signal Hound USB 3.0 device will stay within this allocation size, but two devices will exceed this limitation and can cause connection issues or will cause the software to crash.</p>
<p >The USB memory allocation size can be changed by writing to the file</p>
<p ><code>/sys/module/usbcore/parameters/usbfs_memory_mb</code></p>
<p >A good value would be N * 16 where N is the number of devices you plan on interfacing simultaneously. One way to write to this file is with the command:</p>
<div class="fragment"><div class="line">sudo sh -c ‘echo 32 &gt; /sys/module/usbcore/parameters/usbfs_memory_mb’</div>
</div><!-- fragment --><p >where 32 can be replaced with any value you wish. You may need to restart the system for this change to take effect.</p>
<p >*Includes both Signal Hound USB 3.0 spectrum analyzers and signal generators.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Other Programming Languages</h1>
<p >The BB60 interface is C compatible which ensures it is possible to interface the API in most languages that can call C functions. These languages include C++, C#, Python, MATLAB, LabVIEW, Java, etc. Some examples of calling the API in these other languages are included in the code examples folder.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Device Connection Errors</h1>
<p >The API issues errors when fatal connection issues are present during normal operation of the device. The two major errors in this category are <a class="el" href="bb__api_8h.html#abc8751772e5c7903c5b223fa8a239fcaa43df4fabfdac7c5a7ccc52d552c9676d">bbPacketFramingErr</a> and <a class="el" href="bb__api_8h.html#abc8751772e5c7903c5b223fa8a239fcaa3acda7cd12e4db54bf8fdf24effc73eb">bbDeviceConnectionErr</a>. These errors are reported on fetch routines, as these routines contain most major device I/O.</p>
<p ><a class="el" href="bb__api_8h.html#abc8751772e5c7903c5b223fa8a239fcaa43df4fabfdac7c5a7ccc52d552c9676d">bbPacketFramingErr</a> – Packet framing issues can occur in low power settings or when large interrupts occur on the PC (typically large system interrupts). This error can be handled by manually cycling the device power, or programmatically by using the preset routine.</p>
<p ><a class="el" href="bb__api_8h.html#abc8751772e5c7903c5b223fa8a239fcaa3acda7cd12e4db54bf8fdf24effc73eb">bbDeviceConnectionErr</a> – Device connection errors are the result of major USB issues, most commonly being the device has lost power (unplugged) or interruptions in the USB connection. These errors should be handled by closing and reopening the device with the <a class="el" href="bb__api_8h.html#ac19bb704f9607149f4a8cb9d725f5d1c">bbCloseDevice</a>/<a class="el" href="bb__api_8h.html#ab92ec1dec31d08f9a77d6ab057f4dd07">bbOpenDevice</a> functions. In some cases, the device may need to be fully power cycled by disconnecting and reconnecting the USB cable.</p>
<h2><a class="anchor" id="autotoc_md25"></a>
Firmware Version 7 (BB60C)</h2>
<p >This firmware update has increased the stability of the BB60C on PCs that have a heavy CPU load or in instances where there is random data loss over USB. Currently in the instance where a PC kernel load is high, the PC may not be able to service the USB causing data loss to occur, and the BB60C API reports device connection issues, requiring a device preset. This can also happen if there is (random) data loss over USB 3.0 (rarer). This update resolves these issues by not failing on the connection issues and issuing a warning on the fetch trace functions notifying a user to discard the sweep and try again. The benefit of this is that the API and device remain connected and do not require a preset, often taking about 6 seconds. If you have a device that requires a firmware update, contact Signal Hound.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Manual Gain/Attenuation</h1>
<p >Gain and attenuation are used to control the path the RF takes through the device. Selecting the proper gain and attenuation settings greatly affect the dynamic range of the resulting signal. When gain and attenuation are set to automatic, the reference level is used to control the internal amplifiers and attenuators. Choosing a reference level slightly above the maximum expected power level ensures the device engages the best possible configuration. Manually configuring gain and attenuation should only be used after testing and observation.</p>
<p >Additionally, when gain and attenuation are set to auto in sweep mode, the API can optimize the gain and attenuation across the frequency range of the device. When using manual settings, it will use the same gain/atten values across the entire span, which may be sub-optimal.</p>
<h1><a class="anchor" id="IQDataTypes"></a>
I/Q Data Types</h1>
<p >I/Q data is returned from the <a class="el" href="bb__api_8h.html#aad55bfbe52c9620a1551807127d19065">bbGetIQ</a> function either as 32-bit complex floats or 16-bit complex shorts depending on the data type set in <a class="el" href="bb__api_8h.html#ac22dfa48e694a5335bcf1e6ceda8c69d">bbConfigureIQDataType</a>. 16-bit shorts are twice as memory efficient as floats but require more effort to convert to absolute amplitudes and may be less convenient to work with.</p>
<p >When data is returned as 32-bit complex floats, the data is scaled to mW and the amplitude can be calculated by the following equation:</p>
<div class="fragment"><div class="line">samplePowerDBm = 10.0 * log10(re*re + im*im);</div>
</div><!-- fragment --><p >where <code>re</code> and <code>im</code> are the real and imaginary components of a single I/Q sample.</p>
<p >When data is returned as 16-bit complex shorts, the data is full scale and a correction must be applied before you can measure mW or dBm. Values range from [-32768 to +32767]. To measure the power of a sample using the complex short data type, three steps are required:</p>
<ol type="1">
<li>Convert from short to float. <div class="fragment"><div class="line"><span class="keywordtype">float</span> re32f = ((float)re16s / 32768.0);</div>
<div class="line"><span class="keywordtype">float</span> im32f = ((float)im16s / 32768.0); <span class="comment">// This converts the short to a float in the range of [-1.0 to +1.0]</span></div>
</div><!-- fragment --></li>
<li>Scale the floats by the correction value returned from <a class="el" href="bb__api_8h.html#a67aa30099c50ebf1896a44b181b11dcc">bbGetIQCorrection</a>. <div class="fragment"><div class="line">re32f *= correction;</div>
<div class="line">im32f *= correction;</div>
</div><!-- fragment --></li>
<li>Calculate power <div class="fragment"><div class="line">samplePowerDBm = 10.0 * log10(re32f*re32f + im32f*im32f);</div>
</div><!-- fragment --></li>
</ol>
<h1><a class="anchor" id="IQFilteringAndBandwidthLimitations"></a>
I/Q Filtering and Bandwidth Limitations</h1>
<p >Users can control the baseband software filter when I/Q streaming. Software filtering is always enabled. For each decimation rate, a maximum bandwidth can be provided with the <a class="el" href="bb__api_8h.html#a4752688b429809ea2547f5debaf377eb">bbConfigureIQ</a> function. The table below shows the sample rates and maximum bandwidth for each decimation rate.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Decimation Rate   </th><th class="markdownTableHeadNone">Sample Rate (I/Q pairs/s)   </th><th class="markdownTableHeadNone">Maximum Bandwidth    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">40 MS/s   </td><td class="markdownTableBodyNone">27 MHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">20 MS/s   </td><td class="markdownTableBodyNone">17.8 MHz    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">10 MS/s   </td><td class="markdownTableBodyNone">8.0 MHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8   </td><td class="markdownTableBodyNone">5 MS/s   </td><td class="markdownTableBodyNone">3.75 MHz    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">16   </td><td class="markdownTableBodyNone">2.5 MS/s   </td><td class="markdownTableBodyNone">2.0 MHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">32   </td><td class="markdownTableBodyNone">1.25 MS/s   </td><td class="markdownTableBodyNone">1.0 MHz    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">64   </td><td class="markdownTableBodyNone">625 kS/s   </td><td class="markdownTableBodyNone">0.5 MHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">128   </td><td class="markdownTableBodyNone">312.5 kS/s   </td><td class="markdownTableBodyNone">0.25 MHz    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">256   </td><td class="markdownTableBodyNone">156.250 kS/s   </td><td class="markdownTableBodyNone">140 kHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">512   </td><td class="markdownTableBodyNone">78.125 kS/s   </td><td class="markdownTableBodyNone">65 kHz    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1024   </td><td class="markdownTableBodyNone">39062.5 S/s   </td><td class="markdownTableBodyNone">30 kHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2048   </td><td class="markdownTableBodyNone">19531.25 S/s   </td><td class="markdownTableBodyNone">15 kHz    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">4096   </td><td class="markdownTableBodyNone">9765.625 S/s   </td><td class="markdownTableBodyNone">8 kHz    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">8192   </td><td class="markdownTableBodyNone">4882.8125 S/s   </td><td class="markdownTableBodyNone">4 kHz   </td></tr>
</table>
<h1><a class="anchor" id="gpsAndTimestamps"></a>
Using a GPS Receiver to Time-Stamp Data</h1>
<p >With minimal effort it is possible to determine the absolute time (up to 50ns) of the ADC samples. This functionality is only available when the device is configured for IF or I/Q streaming. Additionally, this functionality is only available for Windows operating systems. It does not work on Linux.</p>
<p >What you will need:</p>
<ol type="1">
<li>GPS Receiver capable providing NMEA data, specifically the GPRMC string, and a 1PPS output. (Tested with Connor Winfield Xenith TBR FTS500)</li>
<li>The NMEA data must be provided via RS232 (Serial COM port) only once during application startup, releasing the NMEA data stream for other applications such as a “Drive Test Solution” to map out signal strengths.</li>
</ol>
<p >Order of Operations:</p>
<ol type="1">
<li>Ensure correct operation of your GPS receiver.</li>
<li>Connect the 1PPS receiver output to port 2 of the device.</li>
<li>Connect the RS232 receiver output to your PC.</li>
<li>Determine the COM port number and baud rate of the data transfer over RS232 to your PC.</li>
<li>Open the device via bbOpenDevice</li>
<li>Ensure the RS232 connection is not open.</li>
<li>Use <a class="el" href="bb__api_8h.html#a719d21011ddb881bf7876ea753900486">bbSyncCPUtoGPS</a> to synchronize the API timing with the current GPS time. This function will release the connection when finished.</li>
<li>Configure the device for I/Q streaming.</li>
<li>Before initiating the device, use <a class="el" href="bb__api_8h.html#abaf1a8ac8259ff021c0d34d0f11f5d0d">bbConfigureIO</a> and configure port 2 for an incoming rising edge trigger via <a class="el" href="bb__api_8h.html#a69b4897f71b11f570dfb5efb9e87aee0">BB60C_PORT2_IN_TRIG_RISING_EDGE</a> or <a class="el" href="bb__api_8h.html#acdc3711b210bae68f9cc57d12893d737">BB60D_PORT2_IN_TRIG_RISING_EDGE</a>.</li>
<li>Call <a class="el" href="bb__api_8h.html#a94837e7f5ac6882499f46db29bbc0427">bbInitiate</a>(id, <a class="el" href="bb__api_8h.html#aa57c25b4199c6f1b90f90094d5cad246">BB_STREAMING</a>, <a class="el" href="bb__api_8h.html#ab6e41314583ff0144dfef56e3f9ba252">BB_TIME_STAMP</a>). The <a class="el" href="bb__api_8h.html#ab6e41314583ff0144dfef56e3f9ba252">BB_TIME_STAMP</a> argument will tell the API to look for the 1PPS input trigger for timing.</li>
<li>If initiated successfully you can now fetch I/Q data and timestamps with <a class="el" href="bb__api_8h.html#aad55bfbe52c9620a1551807127d19065">bbGetIQ</a>. The timestamp returned will be the time of the first sample in the array of data collected.</li>
</ol>
<h2><a class="anchor" id="autotoc_md27"></a>
Code Example</h2>
<p >See the examples folder in the API download for an example of timestamping the I/Q data using a GPS receiver.</p>
<h1><a class="anchor" id="autotoc_md28"></a>
Calculating FFT Size</h1>
<p >For a given RBW, the FFT size used for sweeps can be calculated with the following algorithm:</p>
<div class="fragment"><div class="line"><span class="keywordtype">double</span> BestFFTSize = (80.0e6 * WindowBW) / RBW;</div>
<div class="line"><span class="keywordtype">double</span> ActualFFTSize = RoundUpToNextPowerOf2(BestFFTSize) * C;</div>
<div class="line"><span class="keywordtype">double</span> ZeroPadding = ActualFFTSize - BestFFTSize;</div>
</div><!-- fragment --><p >Where</p><ul>
<li><code>WindowBW</code> equals 2.02 for Nuttall windows, 3.7702 for flattop windows and 2.65 for CISPR windows.</li>
<li><code>C</code> equals 2 for CISPR windows and 1 for Nuttall and flattop windows.</li>
</ul>
<h1><a class="anchor" id="autotoc_md29"></a>
Contact Information</h1>
<p >For technical support, email <a href="#" onclick="location.href='mai'+'lto:'+'sup'+'po'+'rt@'+'si'+'gna'+'lh'+'oun'+'d.'+'com'; return false;">support@signalhound.com</a>.</p>
<p >For sales, email <a href="#" onclick="location.href='mai'+'lto:'+'sal'+'es'+'@si'+'gn'+'alh'+'ou'+'nd.'+'co'+'m'; return false;">sales@signalhound.com</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
